35F39DAD-9868-4853-BA93-BB9034ADEAC6  BA93BB9034ADEAC6	0	SP2013-S4-58	                            1	No description available.	1	13	0x1439497C2BFE994B9E1678C3E8A1608C	0	0	0	0	0	0	0	0	2014-09-29 17:03:39.260	2014-09-29 17:03:39.263	4E9112457-403A-472B-ABBC-ACF8B3EDADE0  ABBCACF8B3EDADE0  0	SP2013-S4-sp2013_S4_To_DGPAP2_B01-60	    1	No description available.	1	15	0x1439497C2BFE994B9E1678C3E8A1608C	0	0	0	0	0	0	0	0	2014-09-29 17:07:30.867	2014-09-29 17:07:30.907	44A82DBEE-AC36-4344-9BBE-7A4FEA6E9A75	                0	SP2013-S4-sp2013_S4_To_DGPAP2_B-DGPAP2-133	1	No description available.	1	10	0x1439497C2BFE994B9E1678C3E8A1608C	0	0	0	0	0	0	0	0	2014-09-30 10:45:25.730	2014-09-30 10:45:25.733	4#MSlogreader_agents58	SP2013-S4-58	5	S4	ALL	1	0xAD9DF33568985348BA93BB9034ADEAC6	2	0	sa	ꦉꢈꖅꒄꦘꢞꞟꛧꖓ꒖ꏠꊒꆘꃦ龭麫鷞鲭鯚骯馠颭鞧隦闐钠鎠銦醥邤辻躹趹貴设調覸袱螲蚳薽蒼莶芳	0E015D95-726A-4036-B5AE-BA96EEF163BF#MSdistribution_agents133	SP2013-S4-sp2013_S4_To_DGPAP2_B-DGPAP2-133	61	5	S4	sp2013_S4_To_DGPAP2_B01	0	DB01kaoG3832	0	1	0xEEDB824A36AC44439BBE7A4FEA6E9A75	0x583E63A40C2B3248AB669F50607385CB	14	NULL	NULL	NULL	NULL	2014-09-30 10:44:43.160	NULL	0	0	NULL	NULL		0	0x1439497C2BFE994B9E1678C3E8A1608C	NULL	0	sa	ꦉꢈꖅꒄꧨꢝꞞꛧꗧ꒜ꎛꋧꆑꂗ龩默鷟鲬鮩骪駜颪鞦隥闖铗鎠銠釕郖辻躹趺貿诏誻觍袺螶蛇薷蓀莴苇	0	309D00F2-A8F2-43D0-8113-CE2CF56DC334	NULL	NULL	NULL	NULL	NULL	NULL	NULL#MSsnapshot_agents60	SP2013-S4-sp2013_S4_To_DGPAP2_B01-60	5	S4	sp2013_S4_To_DGPAP2_B01	0	1	0x572411E93A402B47ABBCACF8B3EDADE0	1	NULL	NULL	0	sa	ꦉꢈꖅꒄꧭꢚꞓꚑꖗꓡꎑꋡꆖꂕ鿛麬鷙鳙鮨骨馫颯鞡雒関钭鎢鋐釐邡辻躼跋貴诊誺觍裊螴蚱薲蓆莶芶	FE5DE994-5138-45FC-93BF-E59E4D9FE147#---------------------------------------------------------------B22E04D8-1413-437D-A699-D223BD5583DC	0	DGPAP1-S3-52	            1	No description available.	1	13	0x1439497C2BFE994B9E1678C3E8A1608C	0	0	0	0	0	0	0	0	2014-09-19 15:58:23.657	2014-09-19 15:58:23.660	4453A388C-2E98-488E-8D7C-DE9A9827F4D9	0	DGPAP1-S3-S3-1-53	        1	No description available.	1	15	0x1439497C2BFE994B9E1678C3E8A1608C	0	0	0	0	0	0	0	0	2014-09-19 15:58:27.473	2014-09-19 15:58:27.487	4E76F5998-6DF7-446A-B9B7-8345EAE7FDA1	0	DGPAP1-S3-S3-1-WIN-MING-125	1	No description available.	1	10	0x1439497C2BFE994B9E1678C3E8A1608C	0	0	0	0	0	0	0	0	2014-09-19 16:00:05.740	2014-09-19 16:00:05.743	452	DGPAP1-S3-52	4	S3	ALL	1	0xD8042EB213147D43A699D223BD5583DC	2	0	sa	ꦉꢈꖅꒄꧫꢟꞔꚖꖒ꒓ꎛꋦꇠꂐ鿝黜鶥鳙鮩骨駛颪鞠隦閬钤鎣銥醧邧辶躽趸賉讳誼覱袻螰蚲薱蒴莲芰	4CA98B73-46D0-41D4-B5F8-9C89D280A556    B22E04D8-    1413-   437D-  A699-D223BD5583DC    D8042EB2 1314    7D43 A699       D223BD5583DC      35F39DAD   9868-  4853-     BA93-BB9034ADEAC6      AD9DF335   6898   5348      BA93  BB9034ADEAC6$publisherServer='sp2013'$distServer='DGPAP2'$subscriberServer='DGPAP2'$pdbname='S4'$sdbname='DB01kaoG3832'$dDBName='distribution'$PName='sp2013_S4_To_DGPAP2_B01'$Pdescription='Transactional by Ming'$job_login='csd\administrator'$job_password='p@ssw0rd'$publisher_login='sa'$publisher_password='p@ssw0rd'$subscriber_login='sa'$subscriber_password='p@ssw0rd'function Preinitialize 
{ #p.63
Param(
  [string] $publisherServer,
  [string] $pdbname,
  [string] $distServer
)

##
$tsql_select=@"      
select distinct p.publication as [Publication],p.publisher_db as [publisherdb],r.name as [subscriber],s.subscriber_db as [subscriberdb]
from distribution.dbo.MSpublications  p 
join distribution.dbo.MSsubscriptions  s on p.publication_id=s.publication_id
join sys.servers  r on s.subscriber_id =r.server_id
where p.publication='$PName'
"@
$getpublication=Invoke-Sqlcmd -Query $tsql_select -ServerInstance $distServer  -Database $dDBName
$publisherdb =$getpublication.publisherdb
$subscriber  =$getpublication.subscriber
$subscriberdb=$getpublication.subscriberdb
##
$tsql_selectagent=@"  
select name FROM [distribution]..MSsnapshot_agents where publication='$PName'
"@
$snapshotagent=Invoke-Sqlcmd -Query $tsql_selectagent -ServerInstance $distServer  -Database $dDBName
$snapshota=$snapshotagent.name
##$tsql_select=@" use $publisherdb
EXEC sp_reinitsubscription 
    @subscriber     = N'$subscriber',
    @destination_db = N'$subscriberdb',
    @publication    = N'$PName';
GO"@Invoke-Sqlcmd -Query $tsql_select -ServerInstance $publisherServer  -Database $publisherdbsleep 3##$tsql_start=@" EXEC sp_start_job N'$snapshota'"@ Invoke-Sqlcmd -Query $tsql_start -ServerInstance $distServer  -Database 'msdb'}#p.63